# GitHub Actions Integration

Automatically check code quality on every push and pull request.

## Quick Setup

**1. Generate the workflow file:**

```bash
coco "Generate GitHub Actions quality workflow"
# or manually:
```

**2. Create `.github/workflows/quality.yml`:**

```yaml
name: Quality Check

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  quality:
    name: Code Quality
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: latest

      - uses: actions/setup-node@v4
        with:
          node-version: "22"
          cache: "pnpm"

      - run: pnpm install --frozen-lockfile

      - name: Run quality check
        run: pnpm coco check --output json --output-file .coco/reports/quality.json

      - name: Upload report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: quality-report
          path: .coco/reports/quality.json
          retention-days: 30

      - name: Post PR comment
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const report = JSON.parse(fs.readFileSync('.coco/reports/quality.json', 'utf8'));
            const score = Math.round(report.scores.overall);
            const status = report.meetsMinimum ? '‚úÖ PASS' : '‚ùå FAIL';
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## Quality Check ‚Äî ${status}\n\n**Overall score: ${score}/100**\n\n> Generated by Corbat-Coco`
            });
```

## Configuration Options

### Fail on below-minimum score (default: yes)

```yaml
- name: Run quality check
  run: pnpm coco check --output json --output-file .coco/reports/quality.json
  # Remove `continue-on-error` to fail the build when quality is too low
```

To allow the job to pass even if quality is below minimum (useful when iterating):

```yaml
- name: Run quality check
  run: pnpm coco check ...
  continue-on-error: true
```

### npm or yarn projects

```yaml
# npm
- run: npm ci
- run: npx coco check --output json --output-file .coco/reports/quality.json

# yarn
- run: yarn install --frozen-lockfile
- run: yarn coco check --output json --output-file .coco/reports/quality.json
```

### Custom quality thresholds per branch

Use `.coco.config.json` at the project root ‚Äî it's automatically picked up in CI:

```json
{
  "quality": {
    "minScore": 88,
    "minCoverage": 82,
    "securityThreshold": 100
  }
}
```

## PR Comment Format

When a PR is opened or updated, Coco posts a comment like:

> ## Quality Check ‚Äî ‚úÖ PASS
>
> **Overall score:** `87/100` | **Evaluated:** 2026-02-19
>
> <details>
> <summary>üìä Dimension breakdown</summary>
>
> | Dimension | Score | Status |
> |-----------|------:|--------|
> | Correctness | 92 | ‚úÖ |
> | Security | 100 | ‚úÖ |
> | Test Coverage | 78 | ‚ö†Ô∏è |
> | ... | | |
>
> </details>
>
> <details>
> <summary>üîç Issues (2)</summary>
>
> - üü° **[testCoverage]** Coverage below threshold (78% < 80%)
> - üîµ **[documentation]** JSDoc coverage low (42%)
>
> </details>
>
> ---
> *ü•• Generated by Corbat-Coco*

## Java Projects ‚Äî JaCoCo Integration

For Java projects, ensure JaCoCo generates a report before running `coco check`:

```yaml
- name: Build and test with JaCoCo
  run: mvn test jacoco:report

- name: Run quality check
  run: npx coco check --output json --output-file .coco/reports/quality.json
```

Configure the report path in `.coco.config.json`:

```json
{
  "language": "java",
  "analyzers": {
    "java": {
      "reportPath": "target/site/jacoco/jacoco.xml"
    }
  }
}
```

## React Projects

React projects are detected automatically from `.tsx`/`.jsx` files. The quality check includes:
- Component quality (key props, TypeScript types)
- Accessibility violations (a11y)
- React Hooks rules compliance

No extra setup needed.

## Monorepo Setup

For monorepos, run quality checks per package:

```yaml
strategy:
  matrix:
    package: [api, web, shared]

steps:
  - uses: actions/checkout@v4
  - run: pnpm install --frozen-lockfile
  - name: Check ${{ matrix.package }}
    run: pnpm --filter ${{ matrix.package }} coco check
    working-directory: packages/${{ matrix.package }}
```

Each package can have its own `.coco.config.json` with different thresholds, inheriting from a shared base:

```json
// packages/api/.coco.config.json
{
  "extend": "../../.coco.config.json",
  "quality": { "minScore": 90 }
}
```

## Artifacts and Reports

Quality reports are uploaded as workflow artifacts:

```
Actions ‚Üí <workflow run> ‚Üí Artifacts ‚Üí quality-report
```

The JSON report structure:

```json
{
  "scores": {
    "overall": 87.3,
    "dimensions": {
      "correctness": 92,
      "security": 100,
      "testCoverage": 78,
      ...
    },
    "evaluatedAt": "2026-02-19T12:00:00.000Z",
    "evaluationDurationMs": 1234
  },
  "meetsMinimum": true,
  "meetsTarget": false,
  "issues": [...],
  "suggestions": [...]
}
```

---

See also:
- [Quality Guide](QUALITY.md)
- [Configuration Guide](CONFIGURATION.md)
- [Providers Guide](PROVIDERS.md)
